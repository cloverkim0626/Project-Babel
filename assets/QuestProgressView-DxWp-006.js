import{r as u,h as O,u as H,j as e,b as g,C as P,s as S}from"./index-CxDURwdF.js";import{u as W}from"./useGameEngine-BLgTsvBL.js";import{T as $}from"./trophy-D3N6qlO7.js";import{A as Y}from"./arrow-left-CDGCNdZG.js";import{B}from"./book-open-HbqM0iWU.js";import{S as V}from"./skull-BJrRaref.js";import{C as Q}from"./clock-CfoMDaUY.js";import{Z as U}from"./zap-BFQRgAZw.js";const X=864e5,Z=36e5,C=Symbol.for("constructDateFrom");function z(t,s){return typeof t=="function"?t(s):t&&typeof t=="object"&&C in t?t[C](s):t instanceof Date?new t.constructor(s):new Date(s)}function T(t,s){return z(t,t)}function D(t){const s=T(t),n=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return n.setUTCFullYear(s.getFullYear()),+t-+n}function v(t,...s){const n=z.bind(null,s.find(o=>typeof o=="object"));return s.map(n)}function M(t,s){const n=T(t);return n.setHours(0,0,0,0),n}function G(t,s,n){const[o,l]=v(n?.in,t,s),a=M(o),d=M(l),m=+a-D(a),c=+d-D(d);return Math.round((m-c)/X)}function K(t,s,n){const[o,l]=v(n?.in,t,s),a=E(o,l),d=Math.abs(G(o,l));o.setDate(o.getDate()-a*d);const m=+(E(o,l)===-a),c=a*(d-m);return c===0?0:c}function E(t,s){const n=t.getFullYear()-s.getFullYear()||t.getMonth()-s.getMonth()||t.getDate()-s.getDate()||t.getHours()-s.getHours()||t.getMinutes()-s.getMinutes()||t.getSeconds()-s.getSeconds()||t.getMilliseconds()-s.getMilliseconds();return n<0?-1:n>0?1:n}function J(t){return s=>{const o=(t?Math[t]:Math.trunc)(s);return o===0?0:o}}function _(t,s,n){const[o,l]=v(n?.in,t,s),a=(+o-+l)/Z;return J(n?.roundingMethod)(a)}const ee=t=>{const[s,n]=u.useState({timeLeft:"",isCorroded:!1,isWarning:!1,hoursRemaining:0});return u.useEffect(()=>{if(!t)return;const l=()=>{const d=new Date,m=new Date(t),c=_(m,d),p=K(m,d),j=c<=24&&c>0,h=c<=0;let b="";h?b="CORRODED":p>0?b=`${p}d ${c%24}h`:b=`${c}h ${Math.max(0,60-d.getMinutes())}m`,n({timeLeft:b,isCorroded:h,isWarning:j,hoursRemaining:c})};l();const a=setInterval(l,6e4);return()=>clearInterval(a)},[t]),{...s,checkItemCorrosion:(l,a=24)=>{const d=new Date,m=new Date(l);return _(d,m)>=a}}},ce=()=>{const{id:t}=O(),s=H(),{addXp:n,addPoints:o,logError:l}=W(),[a,d]=u.useState([]),[m,c]=u.useState(!0),[p,j]=u.useState("Loading Mission...");u.useEffect(()=>{if(!t)return;(async()=>{const{data:f}=await S.from("missions").select("title, config").eq("id",t).single();f&&j(f.title);const{data:r}=await S.from("quest_sets").select("*").eq("mission_id",t).order("week_number",{ascending:!0}).order("set_index",{ascending:!0});r&&d(r.map(x=>({id:x.id,index:x.set_index,status:x.status,score:x.score,week:x.week_number||1}))),c(!1)})()},[t]);const h=u.useMemo(()=>{const i={};return a.forEach(f=>{const r=f.week||1;i[r]||(i[r]=[]),i[r].push(f)}),i},[a]),[b,I]=u.useState(!1),w=a.length>0&&a.every(i=>i.status==="passed"),[N,q]=u.useState(!1);u.useEffect(()=>{if(w&&!N){const i=setTimeout(()=>{I(!0),q(!0),n(300),o(100)},500);return()=>clearTimeout(i)}},[w,N,n,o]);const[A]=u.useState(()=>new Date(Date.now()+864e5*2).toISOString()),k=ee(A),R=i=>{if(i.status==="locked"){alert("This sequence is sealed. Explain the previous grimoire first.");return}s(`/mission/${i.id}/play`)},F=()=>{l("Ephemeral"),alert("Mock Error Logged: 'Ephemeral' added to Ebbinghaus Vault (+1 min)")},L="/assets/party_splash.jpg";return m?e.jsx("div",{className:"min-h-screen bg-obsidian flex items-center justify-center text-babel-gold",children:"Loading Arcanum..."}):e.jsxs("div",{className:"min-h-screen bg-obsidian text-paper font-mono flex flex-col relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://images.unsplash.com/photo-1541701494587-cb58502866ab?q=80&w=2670&auto=format&fit=crop')] bg-cover bg-center opacity-30 pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-purple-950/80 via-black/60 to-black/90 pointer-events-none"}),b&&e.jsxs("div",{className:"absolute inset-0 z-50 bg-black/90 backdrop-blur-md flex flex-col items-center justify-center animate-in fade-in duration-1000",children:[e.jsx($,{size:80,className:"text-babel-gold mb-6 animate-bounce"}),e.jsx("h1",{className:"text-5xl font-serif text-babel-gold font-bold mb-2 text-center text-shadow-gold",children:"ARCHIVE RESTORED"}),e.jsx("p",{className:"text-stone-300 tracking-widest uppercase mb-8",children:"All Sequences Stabilized"}),e.jsxs("div",{className:"text-center mb-8 animate-pulse text-babel-gold",children:["+300 XP Awarded",e.jsx("br",{}),"+100 Points Acquired"]}),e.jsx("div",{className:"flex gap-4",children:e.jsx("button",{onClick:()=>s("/world-map"),className:"px-8 py-3 bg-babel-gold text-obsidian font-bold rounded hover:scale-105 transition-transform",children:"Return to World Map"})})]}),e.jsxs("div",{className:"p-6 border-b border-white/10 flex items-center justify-between bg-black/60 backdrop-blur z-20 sticky top-0",children:[e.jsxs("button",{onClick:()=>s("/world-map"),className:"flex items-center gap-2 text-stone-400 hover:text-white transition-colors",children:[e.jsx(Y,{size:16})," ",e.jsx("span",{className:"text-xs uppercase tracking-widest",children:"목록으로"})]}),e.jsx("div",{className:"text-center",children:e.jsxs("h2",{className:"text-xl font-serif text-babel-gold flex items-center justify-center gap-2 text-shadow-sm",children:[e.jsx(B,{size:18}),p]})}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("button",{onClick:F,className:"p-2 border border-pain/30 text-pain rounded full hover:bg-pain hover:text-white transition-colors",title:"Simulate Wrong Answer",children:e.jsx(V,{size:14})}),e.jsxs("div",{className:g("flex items-center gap-2 text-xs border px-3 py-1 rounded",k.isWarning?"border-pain text-pain animate-pulse":"border-stone-700 text-stone-400"),children:[e.jsx(Q,{size:14}),e.jsxs("span",{children:[k.timeLeft," 남음"]})]})]})]}),e.jsx("div",{className:"flex-1 relative overflow-auto p-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-16",children:[Object.entries(h).map(([i,f])=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("div",{className:"h-px bg-white/10 flex-1"}),e.jsxs("div",{className:"text-babel-gold border border-babel-gold/30 px-4 py-1 rounded-full text-sm font-bold bg-black/50",children:["WEEK ",i]}),e.jsx("div",{className:"h-px bg-white/10 flex-1"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12 md:gap-24 relative",children:[e.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-white/5 -translate-x-1/2 hidden md:block"}),f.map((r,x)=>{const y=x%2===0;return e.jsxs("div",{className:g("flex flex-col relative z-10",y?"md:items-end md:text-right":"md:items-start md:text-left","md:transform md:translate-y-6"),onClick:()=>R(r),children:[r.status==="open"&&e.jsx("div",{className:g("absolute -top-20 z-20 w-20 h-20 animate-bounce transition-all duration-500",y?"right-2":"left-2"),children:e.jsx("div",{className:"w-full h-full rounded-full border-2 border-babel-gold shadow-[0_0_20px_rgba(212,175,55,0.6)] overflow-hidden bg-black relative",children:e.jsx("img",{src:L,alt:"Coordinator",className:"w-[400%] max-w-none h-full object-cover",style:{objectPosition:"100% 20%"}})})}),e.jsxs("div",{className:g("w-full p-4 border rounded-xl backdrop-blur-md transition-all duration-300 cursor-pointer hover:scale-105 group relative overflow-hidden",r.status==="locked"&&"bg-black/40 border-white/5 text-stone-600 grayscale opacity-60",r.status==="open"&&"bg-black/60 border-babel-gold shadow-[0_0_20px_rgba(212,175,55,0.2)]",r.status==="passed"&&"bg-emerald-900/20 border-emerald-500/50 text-emerald-100"),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:g("w-8 h-8 rounded-full flex items-center justify-center border",r.status==="open"?"border-babel-gold bg-babel-gold text-black font-bold":"border-white/10 bg-white/5"),children:r.status==="passed"?e.jsx(P,{size:16}):r.index}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-serif font-bold text-lg",children:["Sequence ",r.index<10?`0${r.index}`:r.index]}),e.jsx("p",{className:"text-[10px] uppercase tracking-widest opacity-70",children:r.status==="locked"?"Access Denied":r.status==="open"?"Ready to Start":"Stabilized"})]})]}),r.status==="open"&&e.jsxs("div",{className:"mt-2 text-xs text-babel-gold flex items-center gap-1 animate-pulse",children:[e.jsx(U,{size:12,fill:"currentColor"})," Click to Synchronize"]})]})]},r.id)})]})]},i)),a.length===0&&e.jsx("div",{className:"text-center text-stone-500 py-20",children:"No sequences found for this archive."})]})}),e.jsx("div",{className:"p-4 text-center text-[10px] text-stone-500 border-t border-white/5 bg-black/80",children:"도서관의 기록을 순서대로 복원하십시오."})]})};export{ce as QuestProgressView,ce as default};
